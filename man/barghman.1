.\" Manpage for Barghman
.TH barghman 1 "August 2025" "v0.1.0" "Barghman Manual"
.SH NAME
barghman \- send blackout schedules as ICS calendar emails
.SH SYNOPSIS
.B barghman
[\-file <config file>]
.SH DESCRIPTION
Barghman connects to the Iran Power electricity provider and sends calendar emails in
ICS format with your blackout schedules. It can run as a standalone command or as a
scheduled service using cron jobs.
.SH INSTALLATION
.nf
git clone git@github.com:dozheiny/barghman.git
cd barghman
make install
.fi
.SH USAGE
.nf
barghman -file <config file>
.fi
.TP
.B -file <config file>
Path to your TOML configuration file.
.SH BUILDING
1. Install the Go compiler from https://go.dev
2. Run the build command:
.nf
make build
.fi
This will compile the barghman binary for your system.
.SH RUNNING
1. Create a TOML configuration file (e.g., example.toml).
2. Update it with your credentials, SMTP details, and client information.
3. Run barghman with the config file:
.nf
barghman -file example.toml
.fi
.SH CONFIGURATION
.SS General Options
.TP
log_level
Logger verbosity level (default: 0).
.TP
cron_job
Cron expression for scheduling the service (e.g., @daily, 0 30 2 * * *).
If empty, Barghman runs as a one-time job. If set, it runs according to the cron expression.
.TP
wait_time
Number of seconds to wait for each client or bill ID. Necessary because the Barghman API
imposes limits on its blackout endpoint.

.SS SMTP Configuration
Each mail provider can be configured under [smtp.<provider>].
.TP
mail
The sender email address.
.TP
host
SMTP server host.
.TP
port
SMTP server port.
.TP
username
Username for SMTP authentication.
.TP
password
Password for SMTP authentication.
.TP
auth_method
Authentication method (plain, cram-md5, custom).
.TP
identity
Optional identity for authentication.
.TP
skip_tls
Set to true to skip TLS verification (not recommended for production).

Example:
.nf
[smtp.gmail]
mail = "your-email@gmail.com"
host = "smtp.gmail.com"
port = "587"
username = "your-email@gmail.com"
password = "your-app-password"
auth_method = "plain"
identity = ""
skip_tls = true
.fi

.SS Client Configuration
Each client represents a connection to an electricity service account.
.TP
smtp
smtp is used to identify each SMTP configuration, allowing you to map specific SMTP configs to your clients. For example if your smtp config starts with [smtp.gmail] then the value of smtp_name should be gmail.
.TP
bill_id
Unique identifier for your electricity bill.
.TP
bill_ids
Unique identifiers for multiple electricity bills. This option was added to avoid breaking changes.
.TP
auth_token
Authentication token provided by https://uiapi.saapa.ir.
.TP
recipients
List of email addresses to send the calendar emails to.
.SH EXAMPLES
Run Barghman with example config:
.nf
barghman -file example.toml
.fi

.SH AUTHOR
Dozheiny <dozheiny@gmail.com>
